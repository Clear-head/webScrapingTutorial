<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ìˆ˜ì§‘ ì¤‘...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            text-align: center;
            margin-top: 50px;
        }

        .progress-container {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .status-info {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .completed {
            color: #4CAF50;
            font-size: 1.2em;
            font-weight: bold;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 20px 10px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ ë°ì´í„° ìˆ˜ì§‘ ì¤‘</h1>

        <div id="status-display">
            {% if status.error %}
                <div class="error">
                    <h3>âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>{{ status.error }}</p>
                    <button class="refresh-btn" onclick="location.href='/'">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            {% elif status.is_running %}
                <div class="spinner"></div>

                <div class="progress-container">
                    <div class="progress-bar" style="width: {{ status.progress }}%"></div>
                </div>

                <div class="status-info">
                    <h3>ì§„í–‰ë¥ : {{ status.progress }}%</h3>
                    <p>í˜„ì¬ ì‘ì—…: {{ status.current_site }}</p>
                    {% if status.last_update %}
                        <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {{ status.last_update }}</p>
                    {% endif %}
                </div>

                <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. ì—¬ëŸ¬ ì‚¬ì´íŠ¸ì—ì„œ ìµœì‹  ê³µëª¨ì „ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

            {% elif status.progress == 100 %}
                <div class="completed">
                    <h3>âœ… ìˆ˜ì§‘ ì™„ë£Œ!</h3>
                    <p>{{ status.current_site }}</p>
                    <button class="refresh-btn" onclick="location.href='/'">ê²°ê³¼ ë³´ê¸°</button>
                </div>
            {% else %}
                <div class="status-info">
                    <h3>â¸ï¸ ìŠ¤í¬ë˜í•‘ ëŒ€ê¸° ì¤‘</h3>
                    <p>ì•„ì§ ì˜¤ëŠ˜ì˜ ë°ì´í„° ìˆ˜ì§‘ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                    {% if status.last_update %}
                        <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {{ status.last_update }}</p>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <div style="margin-top: 30px;">
            <button class="refresh-btn" onclick="checkStatus()">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
            <button class="refresh-btn" onclick="location.href='/'">í™ˆìœ¼ë¡œ</button>
        </div>
    </div>

    <script>
        let checkInterval;

        function checkStatus() {
            fetch('/api/scraping-status')
                .then(response => response.json())
                .then(data => {
                    updateStatusDisplay(data);

                    // ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ í™ˆìœ¼ë¡œ ì´ë™
                    if (!data.is_running && data.progress === 100) {
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 3000);
                    }
                })
                .catch(error => {
                    console.error('ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
                });
        }

        function updateStatusDisplay(status) {
            // ë™ì ìœ¼ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸ (ê°„ë‹¨í•œ ì˜ˆì‹œ)
            if (status.is_running) {
                document.querySelector('.progress-bar').style.width = status.progress + '%';
                // ë” ìƒì„¸í•œ UI ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
            }
        }

        // ìŠ¤í¬ë˜í•‘ ì¤‘ì¼ ë•Œë§Œ ìë™ ìƒˆë¡œê³ ì¹¨
        {% if status.is_running %}
            checkInterval = setInterval(checkStatus, 3000);
        {% endif %}

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì¸í„°ë²Œ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            if (checkInterval) {
                clearInterval(checkInterval);
            }
        });
    </script>
</body>
</html>